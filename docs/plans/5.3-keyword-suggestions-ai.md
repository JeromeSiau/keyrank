# 5.3 Keyword Suggestions AI - Implementation Plan

**Date**: 2026-01-16
**Feature**: AI-powered keyword suggestions with categorized UI
**Approach**: LLM-based generation (Claude)

---

## Overview

Enhance keyword suggestions to use AI for intelligent recommendations categorized by source:
- **High Opportunity**: Keywords where app already ranks + low difficulty
- **Competitor Keywords**: Keywords tracked competitors rank for
- **Long-tail**: Extended variations of base keywords
- **Trending**: Popular/growing keywords in category
- **Related**: Similar to currently tracked keywords

---

## Backend Changes

### 1. New Service: KeywordSuggestionAIService

**File**: `api/app/Services/KeywordSuggestionAIService.php`

```php
class KeywordSuggestionAIService
{
    public function generateSuggestions(
        App $app,
        string $country,
        array $trackedKeywords,
        array $competitors
    ): array {
        // 1. Gather context
        $appDetails = $this->getAppContext($app);
        $competitorKeywords = $this->getCompetitorKeywords($competitors);
        $categoryTrends = $this->getCategoryTrends($app->category_id);

        // 2. Build AI prompt
        $prompt = $this->buildPrompt(
            $appDetails,
            $trackedKeywords,
            $competitorKeywords,
            $categoryTrends
        );

        // 3. Call Claude API
        $response = $this->callClaudeAPI($prompt);

        // 4. Parse and enrich suggestions with metrics
        return $this->parseSuggestions($response, $country);
    }
}
```

**AI Prompt Strategy**:
```
Analyze this app and suggest ASO keywords:

APP: {name} - {category}
DESCRIPTION: {description}
CURRENT KEYWORDS: {tracked_keywords}
COMPETITOR KEYWORDS: {competitor_keywords}
CATEGORY TRENDS: {trending_terms}

Generate 50 keyword suggestions in these categories:
1. HIGH_OPPORTUNITY: Keywords with good search volume but low competition
2. COMPETITOR: Keywords competitors rank for that this app should target
3. LONG_TAIL: 3-4 word phrases targeting specific user intents
4. TRENDING: Rising keywords in this category
5. RELATED: Semantically related to tracked keywords

For each keyword, explain WHY it's suggested.

Output as JSON array with: keyword, category, reason
```

### 2. Update KeywordSuggestion Model

**Migration**: Add new fields
```php
Schema::table('keyword_suggestions', function (Blueprint $table) {
    $table->string('category')->default('high_opportunity')->after('source');
    $table->integer('popularity')->nullable()->after('difficulty_label');
    $table->string('reason')->nullable()->after('popularity');
    $table->string('based_on')->nullable()->after('reason'); // For long-tail/related
});
```

**Sources/Categories**:
- `high_opportunity`
- `competitor_keywords`
- `long_tail`
- `trending`
- `related`

### 3. Update GenerateKeywordSuggestionsJob

- Fetch user's tracked keywords for the app
- Fetch competitor apps and their tracked keywords
- Call `KeywordSuggestionAIService`
- Enrich with real metrics (difficulty, competition) via Apple API
- Store categorized suggestions

### 4. Update API Response

```json
{
  "data": {
    "high_opportunity": [
      {
        "keyword": "budget planner app",
        "popularity": 45,
        "difficulty": 28,
        "difficulty_label": "easy",
        "position": 12,
        "reason": "Good search volume, low competition, you already rank #12",
        "top_competitors": [...]
      }
    ],
    "competitor_keywords": [...],
    "long_tail": [...],
    "trending": [...],
    "related": [...]
  },
  "meta": {
    "app_id": "123456789",
    "country": "US",
    "total": 50,
    "generated_at": "2026-01-16T10:30:00Z",
    "is_generating": false
  }
}
```

---

## Flutter Changes

### 1. Update Models

**keyword_model.dart** - Add fields:
```dart
class KeywordSuggestion {
  final String keyword;
  final String source;
  final String category;      // NEW
  final int? position;
  final int? popularity;      // NEW
  final int competition;
  final int difficulty;
  final String difficultyLabel;
  final String? reason;       // NEW - why suggested
  final String? basedOn;      // NEW - for long-tail/related
  final List<TopCompetitor> topCompetitors;
}

class KeywordSuggestionsResponse {
  // NEW: Categorized structure
  final Map<String, List<KeywordSuggestion>> suggestionsByCategory;
  final int total;
  final DateTime? generatedAt;
  final bool isGenerating;
}
```

### 2. New Screen: KeywordSuggestionsAIScreen

Replace/enhance `KeywordSuggestionsModal` with new categorized UI:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ AI Keyword Suggestions                        [Refresh] [X]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Filter: [All] [ğŸ”¥ High Opp.] [ğŸ‘€ Competitors] [ğŸ“ Long-tail]       â”‚
â”‚          [ğŸ“ˆ Trending] [ğŸ”— Related]                                 â”‚
â”‚  Search: [________________________]                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ”¥ HIGH OPPORTUNITY (12)                              [Expand â–¼]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [âœ“] budget planner app     Pop: 45  Diff: 28 ğŸŸ¢  You: #12   â”‚   â”‚
â”‚  â”‚     "Good volume, low competition, you already rank"        â”‚   â”‚
â”‚  â”‚ [âœ“] expense diary          Pop: 38  Diff: 19 ğŸŸ¢  You: -     â”‚   â”‚
â”‚  â”‚     "Untapped keyword with rising search interest"          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ğŸ‘€ COMPETITOR KEYWORDS (8)                            [Expand â–¼]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ ] bill reminder          Pop: 45  Diff: 54 ğŸŸ   Mint: #2   â”‚   â”‚
â”‚  â”‚     "Mint ranks #2, YNAB ranks #5 - opportunity gap"        â”‚   â”‚
â”‚  â”‚ [ ] subscription tracker   Pop: 39  Diff: 48 ğŸŸ   Mint: #3   â”‚   â”‚
â”‚  â”‚     "Key competitor keyword, 3 of 5 competitors rank"       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“ LONG-TAIL (15)                                     [Expand â–¼]   â”‚
â”‚  ...                                                                â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  8 keywords selected                    [Cancel] [Add Keywords]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key UI Features**:
- Category sections with expand/collapse
- Filter buttons to show specific categories
- Reason text explaining why each keyword is suggested
- Popularity indicator (new metric)
- Visual difficulty indicators (green/yellow/orange/red)
- Batch selection across categories

### 3. Integration Points

- **app_keywords_tab.dart**: Button to open suggestions AI screen
- **keywords_screen.dart**: Quick access from global view
- **Navigation**: Full screen or bottom sheet depending on context

---

## Files to Create/Modify

### Backend (api/)
| Action | File |
|--------|------|
| CREATE | `app/Services/KeywordSuggestionAIService.php` |
| MODIFY | `app/Models/KeywordSuggestion.php` |
| CREATE | `database/migrations/xxxx_add_ai_fields_to_keyword_suggestions.php` |
| MODIFY | `app/Jobs/GenerateKeywordSuggestionsJob.php` |
| MODIFY | `app/Http/Controllers/Api/KeywordController.php` |

### Frontend (app/)
| Action | File |
|--------|------|
| MODIFY | `lib/features/keywords/domain/keyword_model.dart` |
| MODIFY | `lib/features/keywords/data/keywords_repository.dart` |
| MODIFY | `lib/features/keywords/presentation/keyword_suggestions_modal.dart` â†’ Rename/replace |
| CREATE | `lib/features/keywords/presentation/keyword_suggestions_ai_screen.dart` |
| CREATE | `lib/features/keywords/presentation/widgets/suggestion_category_section.dart` |
| MODIFY | `lib/l10n/app_en.arb` (and other locales) |

---

## Implementation Steps

### Batch 1: Backend Foundation
1. Create migration for new fields
2. Update KeywordSuggestion model
3. Create KeywordSuggestionAIService
4. Update GenerateKeywordSuggestionsJob

### Batch 2: Backend API
5. Update suggestions endpoint response format
6. Add competitor keyword extraction logic
7. Test backend with manual API calls

### Batch 3: Flutter Frontend
8. Update KeywordSuggestion model
9. Update repository response parsing
10. Create new categorized UI screen
11. Add l10n strings

### Batch 4: Integration & Polish
12. Wire up UI to existing flows
13. Add loading/error states
14. Test full flow
15. Update tracker

---

## Verification

- [ ] Backend: POST to generate suggestions returns categorized data
- [ ] Backend: AI service generates relevant suggestions
- [ ] Flutter: UI shows categorized sections
- [ ] Flutter: Can select and add keywords from any category
- [ ] Flutter: Proper loading/error states
- [ ] E2E: Full flow from button click to keywords added

---

## Notes

- AI generation may take 30-60 seconds - handle with async job + polling
- Cache AI results for 24h to reduce API costs
- Include fallback to rule-based if AI fails
- Consider rate limiting AI generation per user/app
